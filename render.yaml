services:
  - type: web
    name: soapbox-server
    env: node
    plan: standard
    region: virginia
    repo: https://github.com/bluecollarsoapbox/soapbox-server
    branch: main
    buildCommand: npm ci
    # Seed /data the first time, then start your combined bot+API (bot.js)
    startCommand: >
      bash -lc '
        mkdir -p /data/Stories /data/Spotlights &&
        cp -nR /opt/render/project/src/Stories/* /data/Stories/ 2>/dev/null || true &&
        cp -nR /opt/render/project/src/Spotlights/* /data/Spotlights/ 2>/dev/null || true &&
        node bot.js
      '
    healthCheckPath: /health
    autoDeploy: true

    # Pull your shared envs (edit the name if your group is different),
    # or list values inline below (NODE_ENV/DISCORD_TOKEN/SOAPBOX_API_KEY/etc.)
    envVars:
      - fromGroup: soapbox-shared
      - key: NODE_ENV
        value: production
      - key: DATA_DIR
        value: /data
      - key: STORIES_ROOT
        value: /data/Stories
      - key: SPOTLIGHT_FEED_DIR
        value: /data/Spotlights
      # If you don't use an env group, uncomment and set these here:
      # - key: DISCORD_TOKEN
      #   value: <your-bot-token>
      # - key: SOAPBOX_API_KEY
      #   value: 99dnfneeekdegnrJJSN3JdenrsdnJ

    disk:
      name: soapbox-data
      mountPath: /data
      sizeGB: 5
